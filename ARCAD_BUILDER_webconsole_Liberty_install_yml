
---
# Description:
  # This playbook shows how to install ELIAS REST API on Liberty server using Ansible


# Parameters:
  # target_ibmi : replace by an ibmi host defined in the ansible inventory
  #miss a task to update the server.xml need to check before how it works

# Requirements:
# needs a liberty websphere target to deploy the war

# Example:
  # ansible-playbook -i hosts ELIAS_REST_API_install.yml -e "target_ibmi=your_ibmi"
  

- hosts: '{{ target_ibmi }}'
  gather_facts: no
  
  vars:
    srcpath: "/tmp/elias-jaxrs.war"
    targetdir: "/www/RSEAPI/wlp/usr/servers/RSEAPI"

  tasks:

  - name: Copy file from Ansible Master to target IBM i  on the webapps folder 
    copy:
      src: "{{srcpath}}"
      dest: "{{targetdir}}/apps/"

  - name: backup the server.xml file
    shell: cp {{targetdir}}/server.xml server.xml.bak

  - name: Update server.xml to add the new Elias 
    shell: sed -i 's/s/type="war"/>\n<application autoStart="true" context-root="/builder" id="builder" location="builder.war" name="Builder" type="war" />' server.xml